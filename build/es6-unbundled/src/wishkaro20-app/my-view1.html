<html><head><link rel="import" href="../../bower_components/polymer/polymer-element.html"><link rel="import" href="../../bower_components/iron-list/iron-list.html"><link rel="import" href="../../bower_components/iron-image/iron-image.html"><link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html"><link rel="import" href="../../bower_components/paper-spinner/paper-spinner-lite.html"><link rel="import" href="../../bower_components/paper-spinner/paper-spinner.html"><link rel="import" href="../../bower_components/paper-toast/paper-toast.html"><link rel="import" href="../../bower_components/paper-button/paper-button.html"><link rel="import" href="../../bower_components/polymer/lib/mixins/gesture-event-listeners.html"><link rel="import" href="sharedstyles.html"><link rel="import" href="my-firestoreinit.html"><link rel="import" href="my-firestorequery.html"></head><body><dom-module id="my-view1"><template><style include="sharedstyles">:host{top:92px;}[hidden]{display:none !important;}</style><my-firestoreinit firestoreconfig="{{dbconfig}}" firestorelistsize="{{listsize}}" firestorecollectionhndl="{{dbhandle}}"></my-firestoreinit><my-firestorequery firestorereadconfig="{{dbreadconfig}}" firestorefetchdata="{{reqdata}}" firestoredataobject="{{dataobject}}"></my-firestorequery><div class="container" on-click="handleClick"><iron-list style="width:100%" items="[[imagearray]]" as="item" id="itemlist" scroll-target="document" selection-enabled="" selected-item="{{selectedItem}}" grid=""><template><div class="flexchild" style="width:calc(50% - .5px);"><iron-image class="imagecontainer" sizing="cover" style="width:calc(100% - 4px); height:180px; background-color: lightgray;" preload="" fade="" src="[[item.webp]]" error="{{imageload}}"></iron-image></div></template></iron-list><template is="dom-if" if="{{!_hidespinner}}"><div class="spinnerpos"><paper-spinner active=""></paper-spinner></div></template><paper-toast id="papertoast" class="fit-bottom" text="Hello world!"><paper-button id="papertoastbutton" style="left:16px;" onclick="displayToastClicked" toggles="" raised=""></paper-button></paper-toast></div></template><script>class MyView1 extends Polymer.GestureEventListeners(Polymer.Element){static get is(){return"my-view1"}static get properties(){return{prop1:{type:String,value:"my-view1"},dbreadconfig:{type:Object,value:"null",notify:!0},reqdata:{type:Boolean,value:!1,notify:!0},dataobject:{type:Object,value:"null",observer:"processData"},dbready:{type:Boolean,value:!1,observer:"databaseReady"},dbconfig:{type:Object,value:"null",notify:!0},listsize:{type:Number,value:0,observer:"DatabaseSize"},dbhandle:{type:Object,value:"null"},imagearray:{type:Array},imageload:{type:Boolean,value:!1,observer:"ImageLoadCount"},_viewstate:{type:Object,value:"null"},_hidespinner:{type:Boolean,value:!1}}}ImageLoadCount(){console.log("Image Loaded");this.imageload=!1}constructor(){super();this._observerinit={dbready:"none",dataobject:"none",listsize:"none"};this._viewstate={newlistsize:0,listsize:0,currentpage:0,itemsperpage:8,numberofitems:0,receiveditemsperreq:0,states:greadstate.INIT};this.imagearray=[]}ready(){super.ready();console.log("My view 1 is ready");Polymer.Gestures.addListener(this,"track",e=>this.handleTrackEvent(e));Polymer.Gestures.setTouchAction(this,"auto")}loadMoreData(){console.log("Lucky Lucky")}databaseReady(){if("ready"===this._observerinit.dbready){console.log("Data base is ready");this.dbconfig={collection:"popular",orderby:"sequence"}}else this._observerinit.dbready="ready"}requestData(){this.reqdata=!this.reqdata}processData(){if("ready"===this._observerinit.dataobject){console.log("Process the received data"+this.dataobject.get("sequence"));var imageobject={};imageobject.webp=this.dataobject.get("webp");imageobject.jpg=this.dataobject.get("jpg");this.push("imagearray",imageobject);this._viewstate.receiveditemsperreq++;this._viewstate.numberofitems++;if(this._viewstate.receiveditemsperreq===this._viewstate.itemsperpage){console.log("Read Complete");this._viewstate.states=greadstate.DBINIT;this._viewstate.receiveditemsperreq=0}if(this._viewstate.numberofitems===this._viewstate.listsize){console.log("Full list complete");this._hidespinner=!0;this._viewstate.states=greadstate.DBINIT;this._viewstate.receiveditemsperreq=0}}else this._observerinit.dataobject="ready"}gotdatachanged(){console.log("gotdata changed View1"+this.gotdata.sequence)}handleClick(){console.log("I am clicked")}DatabaseSize(){if("ready"===this._observerinit.listsize){console.log("List Size "+this.listsize);if(this._viewstate.states===greadstate.INIT){console.log("List size receive for the first tiem");this._viewstate.states=greadstate.DBINIT;console.log("DB Handle is "+this.dbhandle);this.dbreadconfig={limit:8,index:0,orderby:"sequence"};this.dbreadconfig.dbhandle=this.dbhandle;this.updateListSize();this.getNextPage()}else this._viewstate.newlistsize=this.listsize}else this._observerinit.listsize="ready"}getNextPage(){if(this._viewstate.states!=greadstate.DBINIT){return}this.dbreadconfig.index=this._viewstate.listsize-this._viewstate.numberofitems;if(this._viewstate.listsize!=this._viewstate.numberofitems){this._viewstate.states=greadstate.READING;console.log("Requesting data ***");this.requestData()}else console.log("List Complete")}updateListSize(){if(0===this._viewstate.listsize){this._viewstate.listsize=this.listsize}else this._viewstate.newlistsize=this.listsize}handleTrackEvent(){console.log("Tracked");if(this._viewstate.states!=greadstate.DBINIT)return;if(!0===this._hidespinner)this.displayToast("Reached end of the list","OK",2e3);if(this.$.itemlist.lastVisibleIndex>=this.imagearray.length-3){console.log("Need more data");this.getNextPage()}}displayToast(text,buttontext,time){this.$.papertoast.text=text;this.$.papertoast.duration=time;this.$.papertoastbutton.textContent=buttontext;this.$.papertoast.open()}displayToastClicked(){console.log("Display toast clicked")}}window.customElements.define(MyView1.is,MyView1);</script></dom-module></body></html>