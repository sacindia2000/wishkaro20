<html><head><link rel="import" href="../../bower_components/polymer/polymer-element.html"><link rel="import" href="../../bower_components/app-route/app-route.html"><link rel="import" href="../../bower_components/app-route/app-location.html"><link rel="import" href="../../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html"><link rel="import" href="../../bower_components/app-layout/app-drawer/app-drawer.html"><link rel="import" href="../../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html"><link rel="import" href="../../bower_components/app-layout/app-header/app-header.html"><link rel="import" href="../../bower_components/app-layout/app-header-layout/app-header-layout.html"><link rel="import" href="../../bower_components/app-layout/app-toolbar/app-toolbar.html"><link rel="import" href="../../bower_components/paper-tabs/paper-tab.html"><link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html"><link rel="import" href="../../bower_components/paper-ripple/paper-ripple.html"><link rel="import" href="../../bower_components/paper-badge/paper-badge.html"><link rel="import" href="../../bower_components/polymer/lib/mixins/mutable-data.html"><link rel="import" href="../../bower_components/iron-pages/iron-pages.html"><link rel="import" href="../../bower_components/iron-icons/iron-icons.html"><link rel="import" href="../../bower_components/iron-image/iron-image.html"><link rel="import" href="../../bower_components/iron-list/iron-list.html"><link rel="import" href="../../bower_components/iron-selector/iron-selector.html"><link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html"><link rel="import" href="sharedstyles.html"><link rel="import" href="my-firebaseinit.html"><link rel="import" href="my-view1.html"><link rel="import" href="my-view2.html"><link rel="import" href="my-view3.html"><link rel="import" href="my-appdrawerlayout.html"><link rel="import" href="my-dbstats.html"><link href="https://fonts.googleapis.com/css?family=Roboto+Slab" rel="stylesheet"></head><body><dom-module id="wishkaro20-app"><template><style include="sharedstyles">:host{display:block;top:0px;@apply (--layout-fullbleed);@apply (--layout-vertical);}iron-list{@apply (--layout-flex-auto);}[hidden]{display:none !important;}.left-bar-item{width:40px;}.menu-btn{display:block;}.logo{text-align:center;}app-drawer{z-index:3;}</style><app-location route="{{route}}"></app-location><app-route route="{{route}}" pattern="/:view" data="{{data}}"></app-route><app-header style="z-index:3" role="navigation" id="header" effects="waterfall" condenses="" reveals=""><app-toolbar><div class="left-bar-item"><paper-icon-button class="menu-btn" icon="menu" on-click="_toggleDrawer" aria-label="Categories"></paper-icon-button></div><div class="logo" main-title="">TRENDING TODAY</div></app-toolbar></app-header><app-drawer slot="drawer" opened="{{drawerOpened}}" swipe-open="" tabindex="0"><iron-image sizing="cover" style="width:256px;height:144px;" src="https://firebasestorage.googleapis.com/v0/b/wishkaro-94738.appspot.com/o/resources%2Fwishkaroiconjpg1.jpg?alt=media&amp;token=f83a81f3-1e43-4826-8ed8-378a1053f1f7"></iron-image><my-appdrawerlayout list="{{categories}}" categoryposition="{{categoryindex}}" categoryselected="{{selectiontoggle}}" updatelistview="{{uiviewupdatetoggle}}"></my-appdrawerlayout></app-drawer><myfirebase-init config="{{_config}}" status="{{firebaseinitstatus}}"></myfirebase-init><my-dbstats dbready="{{firebasedbready}}" categoryarrayuisnapshot="{{categoryarray}}" updateui="{{listupdated}}"></my-dbstats><my-view1 name="view1" dbready="{{firebasedbready}}" overlayset="{{keyhandler}}"></my-view1></template><script>class Wishkaro20App extends Polymer.MutableData(Polymer.Element){static get is(){return"wishkaro20-app"}static get properties(){return{prop1:{type:String,value:"wishkaro20-app"},_config:{type:Object},firebaseinitstatus:{type:String,value:"None",observer:"firaebaseInitStatus"},firebasedbready:{type:Boolean,value:!1,notify:!0},categoryarray:{type:Array,value:function(){return[]}},categoryviewsnapshot:{type:Array,value:function(){return[]}},viewcountarray:{type:Array,value:function(){return[]}},data:{type:Object,reflectToAttribute:!0,observer:"_pageChanged",value:"view1",notify:!0},header:{type:String,value:"Wish Karo"},listupdated:{type:Boolean,observer:"categoryListUpdated"},keyhandler:{type:String,notify:!0,observer:"_keyHandlerUpdated"},startreading:{type:Object,notify:!0},drawerOpened:{type:Boolean,value:!1},categories:{type:Array,value:function(){return[]},notify:!0},viewlist:{type:Array,value:function(){return[]},notify:!0},categoryindex:{type:Number,value:-1},selectiontoggle:{type:Boolean,observer:"getCategoryIndex"},selectpage:{type:Number,value:0},uiviewupdatetoggle:{type:Boolean}}}constructor(){Polymer.setPassiveTouchGestures(!0);super();this.startreading={state:!1,collection:""}}ready(){super.ready();this._config={apiKey:"AIzaSyCZA25rLvj5sFwmn_gcE7pHZU1ABPZB3zc",authDomain:"wishkaro-94738.firebaseapp.com",databaseURL:"https://wishkaro-94738.firebaseio.com",projectId:"wishkaro-94738",storageBucket:"wishkaro-94738.appspot.com",messagingSenderId:"710301933949"}}firaebaseInitStatus(){if("InitSuccess"===this.firebaseinitstatus){console.log("Firebase Init"+this.firebaseinitstatus);this.firebasedbready=!0}}categoryListUpdated(){console.log("categoryListUpdated observer invoked ");this.updateViewSnapshot();this.updateViewList();this.createViewCountReference(this.categoryviewsnapshot,this.viewcountarray);this.updateDrawerUI()}updateViewSnapshot(){this.categoryviewsnapshot=this.categoryarray.map(function(category){var temp={};temp.collection=category.collection;temp.listsize=category.listsize;temp.title=category.title;temp.icon=category.icon;temp.url=category.urlsubstring;return temp})}updateViewList(){this.apendViewList(this.viewlist,this.categoryviewsnapshot);this.markViewlistForDeletion(this.viewlist,this.categoryviewsnapshot);var i=this.viewlist.length;while(i--){if("null"===this.viewlist[i].collection)this.viewlist.splice(i,1)}this.notifyPath("viewlist")}apendViewList(viewlist,categorysnapshot){categorysnapshot.forEach(function(item){console.log("For each ***"+item.collection);var tempcollection=viewlist.find(function(view){console.log("Checking for "+view.collection);return view.collection===item.collection});if("undefined"===typeof tempcollection){var temp={};temp.status=!1;temp.collection=item.collection;console.log("Adding viewlist"+temp.collection);viewlist.push(temp)}})}markViewlistForDeletion(viewlist,categorysnapshot){viewlist.forEach(function(item){for(var i=0;i<categorysnapshot.length;i++){if(item.collection===categorysnapshot[i].collection)return}item.collection="null"})}getCategoryIndex(){console.log("Category selected toggle drawer"+this.categoryindex);if(-1===this.categoryindex)return;this.startreading.collection=this.categoryviewsnapshot[this.categoryindex].collection;this.selectpage=this.categoryindex;this.updateViewedCount(this.categoryviewsnapshot[this.categoryindex].collection,this.categoryviewsnapshot[this.categoryindex].listsize);this._toggleDrawer()}updateViewedCount(collection,count){var viewedcountobj=this.getViewCountByCollection(collection);viewedcountobj.viewedcount=count;this.updateDrawerUI()}_toggleDrawer(){this.drawerOpened=!this.drawerOpened}getLastViewedCount(collection){var viewcount=this.getViewCountByCollection(collection);if("undefined"!=typeof viewcount){console.log(" Collection = "+collection);return viewcount.viewedcount}else return 0}createViewCountReference(categoryarray,viewdcountarray){categoryarray.forEach(function(item){var viewcountobj=viewdcountarray.find(viewcount=>viewcount.collection===item.collection);if("undefined"===typeof viewcountobj){var tempobj={};tempobj.collection=item.collection;tempobj.viewedcount=-1;viewdcountarray.push(tempobj)}})}updateDrawerUI(){this.categories.length=0;for(var i=0,category;i<this.categoryviewsnapshot.length;i++){category={};category.icon=this.categoryviewsnapshot[i].icon;category.title=this.categoryviewsnapshot[i].title;var label=this.categoryviewsnapshot[i].listsize-this.getLastViewedCount(this.categoryviewsnapshot[i].collection);if(100>label)category.label=label.toString();else category.label="99+";this.categories.push(category)}this.uiviewupdatetoggle=!this.uiviewupdatetoggle}getViewCountByCollection(collection){return this.viewcountarray.find(function(item){if(item.collection===collection)return item})}}window.customElements.define(Wishkaro20App.is,Wishkaro20App);</script></dom-module></body></html>