<html><head><link rel="import" href="../../bower_components/polymer/polymer-element.html"><script src="wishkaro20global.js"></script></head><body><dom-module id="my-firestoreinit"><template></template><script>var readlistsize=0;class MyFirestoreInit extends Polymer.Element{static get is(){return"my-firestoreinit"}static get properties(){return{prop1:{type:String,value:"firestore-init"},dataupdatetoggle:{type:Boolean,value:!1,notify:!0},firestoreconfig:{type:Object,value:"null"},firestorecollectionhndl:{type:Object,value:"null",notify:!0},firestorelistsize:{type:Number,value:0,notify:!0},firestoredataobject:{type:Object,value:"null",notify:!0},firestoreerror:{type:String,value:"null",notify:!0}}}static get observers(){return["configFirestore(firestoreconfig.*)"]}constructor(){super();this._observerinit={configFirestore:"none"}}ready(){super.ready()}configFirestore(){console.log("configFirestore Invoked***");if("null"===this.firestoreconfig.collection)return;this.initfirestore(this.firestoreconfig.collection);if(0<=this.firestorelistsize)this.getFirestoreListSize();else{readlistsize=0;this.getFirestoreData()}}initfirestore(collection){if(0===myglobal.firestorehandle){myglobal.firestorehandle=firebase.firestore()}this.firestorecollectionhndl=myglobal.firestorehandle.collection(collection);console.log("Got connection handle for collection"+collection+"Handle"+this.firestorecollectionhndl)}getFirestoreListSize(){myglobal.firestorehandle.collection(this.firestoreconfig.collection).orderBy(this.firestoreconfig.orderby,"desc").limit(1).onSnapshot(function(querySnapshot){querySnapshot.forEach(function(doc){console.log(" List Size: "+doc.get("sequence"));this.firestorelistsize=doc.get("sequence");this.dataupdatetoggle=!this.dataupdatetoggle}.bind(this))}.bind(this))}getFirestoreData(){myglobal.firestorehandle.collection(this.firestoreconfig.collection).orderBy(this.firestoreconfig.orderby,"desc").limit(10).onSnapshot(function(snapshot){console.log("Reset Read list Size");readlistsize=0;snapshot.forEach(function(doc){if(0===readlistsize){console.log("Read the sequence number to get size for the 1st time");this.firestorelistsize=doc.get("sequence");readlistsize=1}console.log(doc.id," => ",doc.data());this.firestoredataobject=doc}.bind(this))}.bind(this))}}window.customElements.define(MyFirestoreInit.is,MyFirestoreInit);</script></dom-module></body></html>